<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" class="no-js">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chi tiết sản phẩm - TD Mobile</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/product-detail.css" th:href="@{/assets/css/product-detail.css}">
  <link rel="stylesheet" href="assets/css/headerSell.css" th:href="@{/assets/css/headerSell.css}">
  <link rel="stylesheet" href="assets/css/footerSell.css" th:href="@{/assets/css/footerSell.css}">
  <script src="assets/js/product-detail.js" th:src="@{/assets/js/product-detail.js}" defer></script>


  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</head>
<body>
<!-- Gọi fragment vào file index.html -->
<div th:replace="~{Fragments/Sell/header :: headerSellFragment}"></div>
<!-- Breadcrumb -->
<section class="breadcrumb-section">
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
        <li class="breadcrumb-item"><a href="#">Điện thoại</a></li>
        <li class="breadcrumb-item active" th:text="${product.name}">iPhone 14 Pro</li>
      </ol>
    </nav>
  </div>
</section>

<!-- Thông báo thành công với thanh tiến trình -->
<div id="successNotification" class="alert alert-success" style="display:none;">
  <strong>Thành công!</strong><br>
  <span id="successMessageText"></span>
  <div id="progressBar" class="progress mt-2" style="height: 5px;">
    <div id="progress" class="progress-bar bg-success" role="progressbar" style="width: 100%;"></div>
  </div>
</div>

<!-- Chi tiết sản phẩm -->
<section class="product-detail">
  <div class="container">
    <div class="row">
      <!-- Hình ảnh sản phẩm -->
      <div class="col-lg-6 col-md-6">
        <div class="product-images">
          <div id="productImageCarousel" class="carousel slide">
            <!-- Ảnh chính -->
            <div class="carousel-inner">
              <div class="carousel-item active">
                <img th:src="${product.imageUrl}" class="d-block w-100" alt="Ảnh 1">
              </div>
              <div class="carousel-item" th:each="product : ${similarProducts}">
                <img th:src="${product.imageUrl}" class="d-block w-100" alt="Ảnh 2">
              </div>
            </div>

            <!-- Nút chuyển trái/phải -->
            <button class="carousel-control-prev custom-carousel-btn" type="button" data-bs-target="#productImageCarousel" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Trước</span>
            </button>
            <button class="carousel-control-next custom-carousel-btn" type="button" data-bs-target="#productImageCarousel" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Tiếp</span>
            </button>
          </div>
          <!-- Thumbnail -->
          <div class="row mt-3">
            <div class="col-2">
              <img th:src="${product.imageUrl}" class="img-fluid thumbnail-img" onclick="gotoSlide(0)" />
            </div>
            <div class="col-2" th:each="product, iterStat : ${similarProducts}">
              <img th:src="${product.imageUrl}" class="img-fluid thumbnail-img" th:attr="onclick=|gotoSlide(${iterStat.index + 1})|" />
            </div>
          </div>
        </div>
      </div>

      <!-- Thông tin sản phẩm -->
      <div class="col-lg-6 col-md-6">
        <div class="product-info">
          <h1 class="product-title" th:text="${product.name}">iPhone 14 Pro</h1>
          <div class="product-rating mb-3">
            <div class="stars">
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star-half-alt"></i>
            </div>
            <span class="rating-text">(4.5/5 từ 128 đánh giá)</span>
          </div>

          <div class="product-price mb-4">
            <span class="current-price" id="price"
                  th:text="${#numbers.formatDecimal(currentPrice, 0, 'POINT', 0, 'POINT') + 'đ'}">24.990.000₫</span>
            <span class="original-price d-none">27.990.000₫</span>
            <span class="discount-percentage d-none">-11%</span>
          </div>

          <div class="product-highlights mb-4">
              <ul>
                  <li><i class="fas fa-check text-success me-2"></i><p class="mb-0" th:text="${'Màn hình ' + product.specification.screenSize + ' inch hiển thị màu sắc đẹp đẽ'}"></p></li>
                  <li><i class="fas fa-check text-success me-2"></i><p class="mb-0" th:text="${'Chip ' + product.specification.chipset + ' siêu mạnh'}"></p></li>
                  <li><i class="fas fa-check text-success me-2"></i><p class="mb-0" th:text="${'Camera chính ' + product.specification.rearCamera}"></p></li>
                  <li><i class="fas fa-check text-success me-2"></i><p class="mb-0" th:text="${'CPU ' + product.specification.cpu + ' mạnh mẽ'}"></p></li>
                  <li><i class="fas fa-check text-success me-2"></i><p class="mb-0" th:text="${'Sạc ' + (#strings.startsWith(product.specification.charging, 'Sạc') or #strings.startsWith(product.specification.charging, 'sạc') ? #strings.substring(product.specification.charging, 4) : product.specification.charging)}"></p></li>
              </ul>
          </div>

          <!-- Lựa chọn màu sắc -->
          <div class="product-options mb-4">
            <h5>Màu sắc:</h5>
            <div class="color-options" id="colorOptions">
              <div class="color-item selected" th:data-color="${product.color}"
                   th:data-price="${#numbers.formatDecimal(currentPrice, 0, 'POINT', 0, 'POINT') + 'đ'}"
                   th:data-product-id="${product.productId}"
                   onclick="selectColor(this)">
                <img th:src="${product.imageUrl}" th:alt="${product.color}" class="color-image">
                <div class="color-details">
                  <span class="color-name" th:text="${product.color}">Titan Tự Nhiên</span>
                  <span class="color-price" th:text="${#numbers.formatDecimal(currentPrice, 0, 'POINT', 0, 'POINT') + 'đ'}" id="color-price-default">25.390.000₫</span>
                </div>
              </div>
              <th:block th:each="p : ${similarProducts}">
                <div class="color-item"
                     th:data-color="${p.color}"
                     th:data-price="${#numbers.formatDecimal(priceByProductId[p.productId], 0, 'POINT', 0, 'POINT') + 'đ'}"
                     th:data-product-id="${p.productId}"
                     >
                  <img th:src="${p.imageUrl}" th:alt="${p.color}" class="color-image">
                  <div class="color-details">
                    <span class="color-name" th:text="${p.color}">Màu khác</span>
                    <span class="color-price"
                          th:text="${#numbers.formatDecimal(priceByProductId[p.productId], 0, 'POINT', 0, 'POINT') + 'đ'}">
                      25.090.000₫
                    </span>
                  </div>
                </div>
              </th:block>

            </div>
          </div>

          <!-- Lựa chọn dung lượng -->
          <div class="product-options mb-4">
            <h5>Dung lượng:</h5>
            <div class="storage-options">
              <div th:each="rom : ${roms}">
                <input type="radio"
                       th:id="'storage-' + ${rom}"
                       name="storage"
                       th:value="${rom}"
                       th:checked="${rom == defaultRom}">
                <label th:for="'storage-' + ${rom}" class="storage-option"
                       th:text="${(rom >= 1000) ? #numbers.formatDecimal(rom / 1000, 1, 1) + 'TB' : rom + 'GB'}">128GB</label>
              </div>

            </div>
          </div>

          <!-- Số lượng -->
          <div class="quantity-section mb-4">
            <h5>Số lượng:</h5>
            <div class="mb-3">
              <strong>Còn lại:</strong> <span id="availableQuantity" th:text="${availableQuantity}">--</span> sản phẩm
            </div>
            <div class="quantity-controls">
              <button type="button" class="btn-quantity" id="btnDecrease">-</button>
              <input type="number" id="quantity" th:value="${availableQuantity > 0 ? '1' : '0'}" th:min="${availableQuantity > 0 ? '1' : '0'}" th:max="${availableQuantity}" readonly>
              <button type="button" class="btn-quantity" id="btnIncrease">+</button>
            </div>
          </div>

          <!-- Nút hành động -->
          <div class="product-actions mb-4">
            <button class="btn btn-primary btn-lg me-3 add-to-cart-btn" th:data-product-id="${product.productId}" th:data-product-name="${product.name}" th:data-product-price="${currentPrice}">
              <i class="fas fa-shopping-cart me-2"></i>Thêm vào giỏ hàng
            </button>
            <button class="btn btn-outline-primary btn-lg me-3 buy-now" id="buyNowBtn">
              <i class="fas fa-bolt me-2"></i>Mua ngay
            </button>
            <!-- <button class="btn btn-success btn-lg">
                <i class="fas fa-bolt me-2"></i>Mua ngay
            </button> -->
          </div>

          <!-- Thông tin giao hàng -->
          <div class="delivery-info">
            <div class="delivery-item">
              <i class="fas fa-truck text-primary me-2"></i>
              <span>Miễn phí giao hàng toàn quốc cho đơn hàng từ 500.000₫</span>
            </div>
            <div class="delivery-item">
              <i class="fas fa-clock text-primary me-2"></i>
              <span>Giao hàng nhanh trong 2-4 giờ tại Hà Nội và TP.HCM</span>
            </div>
            <div class="delivery-item">
              <i class="fas fa-shield-alt text-primary me-2"></i>
              <span>Bảo hành chính hãng 12 tháng</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Tabs thông tin chi tiết -->
<section class="product-tabs">
  <div class="container">
    <ul class="nav nav-tabs" id="productTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab">Mô tả sản phẩm</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="specifications-tab" data-bs-toggle="tab" data-bs-target="#specifications" type="button" role="tab">Thông số kỹ thuật</button>
      </li>
      <li class="nav-item d-none" role="presentation">
        <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab">Đánh giá (128)</button>
      </li>
    </ul>

    <div class="tab-content" id="productTabsContent">
      <!-- Mô tả sản phẩm -->
      <div class="tab-pane fade show active" id="description" role="tabpanel">
        <div class="tab-content-wrapper">
          <h3 th:text="${product.name}">iPhone 14 Pro - Siêu phẩm công nghệ đỉnh cao</h3>
          <p th:text="${product.description}">iPhone 14 Pro là chiếc smartphone cao cấp nhất trong dòng iPhone 14 series, mang đến trải nghiệm hoàn toàn mới với Dynamic Island và camera chính 48MP.</p>

          <div class="row d-none">
            <div class="col-md-6">
              <h4>Thiết kế cao cấp</h4>
              <p>Được chế tác từ thép không gỉ và kính cường lực Ceramic Shield, iPhone 14 Pro không chỉ đẹp mà còn bền bỉ theo thời gian.</p>

              <h4>Màn hình ProMotion</h4>
              <p>Màn hình Super Retina XDR 6.1" với tần số quét 120Hz mang đến trải nghiệm mượt mà và sống động.</p>
            </div>
            <div class="col-md-6">
              <h4>Camera chuyên nghiệp</h4>
              <p>Hệ thống camera Pro với cảm biến chính 48MP cho phép chụp ảnh với độ chi tiết đáng kinh ngạc.</p>

              <h4>Hiệu năng vượt trội</h4>
              <p>Chip A16 Bionic với quy trình 4nm mang đến hiệu năng mạnh mẽ và tiết kiệm pin tối ưu.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Thông số kỹ thuật -->
      <div class="tab-pane fade" id="specifications" role="tabpanel">
        <div class="tab-content-wrapper">
          <div class="specifications-table">
            <table class="table table-striped">
              <tbody>
              <tr>
                <td><strong>Màn hình</strong></td>
                <td th:text="${product.specification.screenSize + ' inch'}"></td>
              </tr>
              <tr>
                <td><strong>Chip xử lý</strong></td>
                <td th:text="${product.specification.chipset}"></td>
              </tr>
              <tr>
                <td><strong>RAM</strong></td>
                <td th:text="${product.specification.ram + 'GB'}"></td>
              </tr>
              <tr>
                <td><strong>Bộ nhớ trong</strong></td>
                  <td>
                    <span th:each="rom,iterStat : ${allRoms}">
                      <span th:text="${rom >= 1000 ? (rom / 1000) + 'TB' : rom + 'GB'}"></span>
                      <span th:if="${!iterStat.last}"> / </span>
                    </span>
                  </td>
              </tr>
              <tr>
                <td><strong>Camera sau</strong></td>
                <td th:text="${product.specification.rearCamera}"></td>
              </tr>
              <tr>
                <td><strong>Camera trước</strong></td>
                <td th:text="${product.specification.frontCamera}"></td>
              </tr>
              <tr>
                <td><strong>Công nghệ sạc</strong></td>
                <td th:text="${product.specification.charging}"></td>
              </tr>
              <tr>
                <td><strong>Hệ điều hành</strong></td>
                <td th:text="${product.specification.operatingSystem}"></td>
              </tr>
              <tr>
                <td><strong>SIM</strong></td>
                <td th:text="${product.specification.sim}"></td>
              </tr>
              <tr>
                <td><strong>CPU</strong></td>
                <td th:text="${product.specification.cpu}"></td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Đánh giá -->
      <div class="tab-pane fade d-none" id="reviews" role="tabpanel">
        <div class="tab-content-wrapper">
          <div class="reviews-summary mb-4">
            <div class="row">
              <div class="col-md-4">
                <div class="rating-overview text-center">
                  <div class="overall-rating">4.5</div>
                  <div class="stars mb-2">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star-half-alt"></i>
                  </div>
                  <p>128 đánh giá</p>
                </div>
              </div>
              <div class="col-md-8">
                <div class="rating-breakdown">
                  <div class="rating-bar">
                    <span>5 sao</span>
                    <div class="progress">
                      <div class="progress-bar" style="width: 68%"></div>
                    </div>
                    <span>68%</span>
                  </div>
                  <div class="rating-bar">
                    <span>4 sao</span>
                    <div class="progress">
                      <div class="progress-bar" style="width: 22%"></div>
                    </div>
                    <span>22%</span>
                  </div>
                  <div class="rating-bar">
                    <span>3 sao</span>
                    <div class="progress">
                      <div class="progress-bar" style="width: 7%"></div>
                    </div>
                    <span>7%</span>
                  </div>
                  <div class="rating-bar">
                    <span>2 sao</span>
                    <div class="progress">
                      <div class="progress-bar" style="width: 2%"></div>
                    </div>
                    <span>2%</span>
                  </div>
                  <div class="rating-bar">
                    <span>1 sao</span>
                    <div class="progress">
                      <div class="progress-bar" style="width: 1%"></div>
                    </div>
                    <span>1%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Danh sách đánh giá -->
          <div class="reviews-list ">
            <div class="review-item">
              <div class="reviewer-info">
                <img src="https://via.placeholder.com/50x50" alt="User" class="reviewer-avatar">
                <div class="reviewer-details">
                  <h6>Nguyễn Văn A</h6>
                  <div class="stars">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                  </div>
                  <span class="review-date">15/01/2024</span>
                </div>
              </div>
              <div class="review-content">
                <p>Sản phẩm rất tốt, camera chụp ảnh đẹp, pin trâu. Dynamic Island rất tiện lợi và mới lạ. Giao hàng nhanh, đóng gói cẩn thận.</p>
              </div>
            </div>

            <div class="review-item">
              <div class="reviewer-info">
                <img src="https://via.placeholder.com/50x50" alt="User" class="reviewer-avatar">
                <div class="reviewer-details">
                  <h6>Trần Thị B</h6>
                  <div class="stars">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="far fa-star"></i>
                  </div>
                  <span class="review-date">12/01/2024</span>
                </div>
              </div>
              <div class="review-content">
                <p>Máy đẹp, chạy mượt. Màn hình sáng và sắc nét. Tuy nhiên giá hơi cao so với mặt bằng chung. Nhưng nhìn chung vẫn hài lòng.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Sản phẩm liên quan -->
<section class="related-products">
  <div class="container">
    <div class="section-title">
      <h2>Sản phẩm liên quan</h2>
      <p>Những sản phẩm tương tự bạn có thể quan tâm</p>
    </div>
    <div class="product-grid">
      <div class="product-card" th:each="product : ${suggestedProducts}">
        <a th:href="@{'/product-detail/product/' + ${product.productId}}" class="product-link">
          <div class="badge">Hot</div>
          <div class="product-thumb">
            <img th:src="${product.imageUrl}" th:alt="${product.name}">
          </div>
          <div class="product-details">
            <h3 th:text="${product.name}">Tên sản phẩm</h3>
            <div class="product-specs">
              <span>Chipset: <span th:text="${product.chipset}">Chipset</span></span>
              <span>Hệ điều hành: <span th:text="${product.operatingSystem}">Hệ điều hành</span></span>
              <span>Màu: <span th:text="${product.color}">Màu sắc</span></span>
            </div>
            <div class="product-price">
              <span class="price" th:text="${#numbers.formatDecimal(product.sellingPrice, 0, 'POINT', 0, 'POINT') + 'đ'}">$799</span>
<!--              <span class="discount">23.990.000₫</span>-->
            </div>
            <div class="product-actions product-action-btn">
              <button class="btn btn-primary add-to-cart-btn me-0" th:attr="data-product-id=${product.productId}, data-product-name=${product.name}, data-product-price=${product.sellingPrice}">
                Xem chi tiết sản phẩm &gt;&gt;
              </button>
            </div>
          </div>
        </a>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<div th:replace="~{Fragments/Sell/footer :: footerSellFragment}"></div>

</body>
</html>